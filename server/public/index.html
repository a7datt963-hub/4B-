<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù…ÙˆÙ‚Ø¹ Ø´Ø­Ù† Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ â€” Ù†Ø³Ø®Ø© Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
  <style>
    /* (Ù†Ø³Ø® Ù†ÙØ³ CSS Ø§Ù„Ø°ÙŠ Ø£Ø±Ø³Ù„ØªÙ‡ Ø³Ø§Ø¨Ù‚Ø§Ù‹ Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø·ÙÙŠÙØ©) */
    * { margin:0; padding:0; box-sizing:border-box }
    body { font-family:Arial,Helvetica,sans-serif; background:#000; color:#fff; overflow-x:hidden }
    header { background:#111; padding:10px 20px; position:relative; text-align:center }
    header img { height:90px; width:auto; display:block; margin:0 auto }
    #ordersStatusBar { margin:8px auto 0; max-width:720px; padding:4px 8px; border-radius:6px; text-align:center; min-height:22px; display:none; overflow:hidden; white-space:normal; pointer-events:none }
    .status-line { color:#FFCB01; padding:2px 4px; margin:2px 0; font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; display:block; font-weight:700; border-bottom:1px solid rgba(255,203,1,0.06); line-height:1.1 }
    .status-line:last-child { border-bottom:none }
    .menu { position:absolute; right:20px; font-size:28px; cursor:pointer; color:#FFCB01; top:50%; transform:translateY(-50%) }
    #personalNumberDisplay { position:absolute; left:20px; top:50%; transform:translateY(-50%); color:#FFCB01; font-weight:bold; font-size:13px }
    #notifBell { position:absolute; right:68px; top:50%; transform:translateY(-50%); font-size:22px; cursor:pointer; color:#FFCB01 }
    #notifBell .badge { background:#ff3b30; color:#fff; border-radius:999px; padding:2px 6px; font-size:12px; margin-left:6px; vertical-align:middle }
    .notif-panel { position:fixed; top:70px; right:20px; width:360px; max-width:92%; background:#111; border:2px solid #FFCB01; border-radius:10px; padding:10px; z-index:1500; box-shadow:0 6px 30px rgba(0,0,0,0.6) }
    .notif-panel.hidden { display:none }
    .sidebar { position:fixed; top:0; right:-100%; width:80%; max-width:300px; height:100%; background:#111; padding:20px; transition:0.28s; z-index:1000; overflow-y:auto; border-left:2px solid #222 }
    .sidebar.active { right:0 }
    .sidebar .avatar { width:48px; height:48px; border-radius:50%; background:#222; display:flex; align-items:center; justify-content:center; font-size:20px; color:#FFCB01; border:2px solid #FFCB01; }
    .container { display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:15px; padding:20px }
    .card { background:#111; border:2px solid #FFCB01; border-radius:12px; padding:20px; text-align:center; cursor:pointer; transition:.25s; aspect-ratio:1/1; display:flex; align-items:center; justify-content:center }
    .card:hover { background:#FFCB01; color:#000 }
    .hidden { display:none }
    .form-box { background:#111; border:2px solid #FFCB01; border-radius:12px; padding:20px; margin:20px }
    select,input,button,textarea { width:100%; padding:10px; margin:10px 0; border-radius:8px; border:none; font-size:16px; background:#222; color:#fff }
    .button-option { background:#222; color:#FFCB01; border:2px solid #FFCB01; margin:5px 0; padding:10px; border-radius:8px; cursor:pointer; width:100%; text-align:center; font-weight:bold }
    .button-option.selected { background:#FFCB01; color:#000 }
    button { background:#FFCB01; color:#000; font-weight:bold; cursor:pointer; border-radius:8px; padding:10px }
    .small-btn { display:inline-block; padding:8px 12px; border-radius:8px; background:#FFCB01; color:#000; cursor:pointer; margin-top:8px; text-align:center }
    .back-btn { display:block; margin:20px auto; background:#FFCB01; color:#000; padding:10px; border-radius:8px; text-align:center; font-weight:bold; cursor:pointer }
    .price-note { color:#FFCB01; font-weight:bold; margin:10px 0; font-size:14px; white-space:pre-line }
    .orders-list { padding:10px; margin:10px; background:#111; border-radius:10px; border:1px solid #333 }
    .order-item { padding:12px; border:2px solid #FFCB01; border-radius:8px; margin-bottom:10px; background:#111 }
    .login-page { max-width:600px; margin:18px auto; padding:16px }
    .muted-small { font-size:13px; color:#aaa; margin-top:6px }
    .upload-status { font-size:13px; color:#aaa; margin-top:6px }
  </style>
</head>
<body>
  <header>
    <img src="https://i.postimg.cc/W1Ysr3QG/image.png" alt="Logo">
    <div id="personalNumberDisplay">Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ: <span id="personalNum">0000000</span></div>
    <div id="notifBell" title="Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª">ğŸ””<span id="notifBadge" class="badge hidden">0</span></div>
    <div class="menu" id="menuBtn">â˜°</div>
    <div id="ordersStatusBar" aria-live="polite" role="status" style="display:none"></div>
  </header>

  <!-- notif panel -->
  <div id="notifPanel" class="notif-panel hidden" aria-live="polite">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
      <h4 style="color:#FFCB01;margin:0">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h4>
      <div style="cursor:pointer;color:#FFCB01" id="notifCloseBtn">Ã—</div>
    </div>
    <div id="notifList"></div>
    <div style="display:flex;gap:8px;margin-top:8px;">
      <div class="small-btn" id="notifClearBtn">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</div>
      <div class="small-btn" id="notifGoOffersBtn">Ø§Ø°Ù‡Ø¨ Ù„Ù„Ø¹Ø±ÙˆØ¶</div>
    </div>
  </div>

  <!-- sidebar -->
  <div id="sidebar" class="sidebar">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <div style="display:flex;gap:10px;align-items:center;cursor:pointer" id="sidebarProfileArea">
        <div class="avatar" id="sidebarAvatar">Ø£</div>
        <div>
          <div id="sidebarName" style="color:#FFCB01;font-weight:700">Ø¶ÙŠÙ</div>
          <div id="sidebarPersonal" style="color:#ccc;font-size:13px">--</div>
        </div>
      </div>
      <div style="cursor:pointer;color:#FFCB01" id="sidebarCloseBtn">Ã—</div>
    </div>

    <a href="#" id="linkHome">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="#" id="linkOrders">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
    <a href="#" id="linkContact">Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…</a>
    <a href="#" id="linkHelp">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø­Ù„ Ù…Ø´ÙƒÙ„Ø©</a>
    <a href="#" id="linkOffers">Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ù‡Ø¯Ø§ÙŠØ§</a>
    <a href="#" id="linkJoinWhats">Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù…Ø¬ØªÙ…Ø¹ ÙˆØ§ØªØ³Ø§Ø¨</a>
    <hr style="border:none;height:1px;background:#222;margin:12px 0">
    <a href="#" id="linkGames">Ù‚Ø³Ù… Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</a>
    <a href="#" id="linkApps">Ù‚Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</a>
    <div style="margin-top:16px;">
      <div class="small-btn" id="btnCharge">Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯</div>
    </div>
  </div>

  <!-- pages -->
  <main id="mainContent">
    <!-- login page -->
    <div id="loginPage" class="form-box login-page hidden">
      <h3 style="text-align:center;color:#FFCB01;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h3>
      <label>Ø¶Ø¹ Ø§Ù„Ø£Ø³Ù…</label>
      <input type="text" id="loginName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
      <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
      <input type="email" id="loginEmail" placeholder="example@domain.com">
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
      <div style="position:relative;">
        <input type="password" id="loginPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
        <button id="loginTogglePwd" style="position:absolute;left:6px;top:10px;height:36px;width:80px;cursor:pointer;">Ø§Ø¸Ù‡Ø§Ø±</button>
      </div>
      <label>Ø±Ù‚Ù… Ù‡Ø§ØªÙ</label>
      <input type="text" id="loginPhone" placeholder="Ù…Ø«Ø§Ù„: 0999xxxxxx">
      <label>Ø¶Ø¹ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø´Ø®ØµÙŠ (ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)</label>
      <input type="text" id="loginPersonalNumber" readonly>
      <div class="small-muted" style="margin-top:6px;">
        Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ù† ÙŠØªÙ… Ø§Ø±Ø³Ø§Ù„ Ø§ÙŠ ÙƒÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ.
        ÙÙ‚Ø· Ù‚Ù… Ø¨ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø§ØµÙ„ÙŠØ© ÙÙÙŠ Ø­Ø§Ù„ Ø­Ø¯ÙˆØ« Ù…Ø´ÙƒÙ„Ø© Ù†Ø³ØªØ·ÙŠØ¹ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ.
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;">
        <button id="doLoginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      </div>
      <div id="loginError" class="error" style="display:none;"></div>
    </div>

    <!-- profile page -->
    <div id="profilePage" class="hidden">
      <div class="form-box">
        <h3 style="text-align:center;color:#FFCB01;">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h3>
        <label>Ø§Ù„Ø§Ø³Ù…</label>
        <input type="text" id="profileName" readonly>
        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input type="email" id="profileEmail" readonly>
        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
        <input type="password" id="profilePassword" readonly>
        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
        <input type="text" id="profilePhone" readonly>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;">
          <button id="requestEditBtn">Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ</button>
          <button id="confirmSaveBtn" class="hidden">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
        </div>
        <div class="back-btn" id="profileBackBtn">â¬… Ø±Ø¬ÙˆØ¹</div>
        <div id="profileMsg" class="muted-small"></div>
      </div>
    </div>

    <!-- home page -->
    <div id="homePage" class="hidden">
      <div class="container">
        <div class="card" id="cardGames">Ù‚Ø³Ù… Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</div>
        <div class="card" id="cardApps">Ù‚Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</div>
      </div>
    </div>

    <!-- help page -->
    <div id="helpPage" class="hidden">
      <div class="form-box">
        <h3 style="text-align:center;">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø­Ù„ Ù…Ø´ÙƒÙ„Ø©</h3>
        <label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø´Ø®ØµÙŠ (ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)</label>
        <input type="text" id="helpPersonalField" readonly>
        <label>-Ø§Ø®ØªØ± Ù…Ø´ÙƒÙ„ØªÙƒ-</label>
        <select id="helpIssueSelect">
          <option value="" disabled selected>-- Ø§Ø®ØªØ± Ù…Ø´ÙƒÙ„ØªÙ„Ùƒ --</option>
          <option value="Ù„Ø§ Ø§Ø³ØªØ·ÙŠØ¹ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª">Ù„Ø§ Ø§Ø³ØªØ·Ø¹ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>
          <option value="Ù‚Ù…Øª Ø¨ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯ ÙˆÙ„Ù… ÙŠÙØ±Ø§Ø¬Ø¹ Ø·Ù„Ø¨ÙŠ">Ù‚Ù…Øª Ø¨ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯ ÙˆÙ„Ù… ÙŠÙØ±Ø§Ø¬Ø¹ Ø·Ù„Ø¨ÙŠ</option>
          <option value="ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ÙŠ Ù„ÙƒÙ† Ù„Ù… ÙŠØµÙ„Ù†ÙŠ Ø´ÙŠØ¡">ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ÙŠ Ù„ÙƒÙ† Ù„Ù… ÙŠØµÙ„Ù†ÙŠ Ø´ÙŠØ¡</option>
          <option value="Ù„Ø§ Ø§Ø³ØªØ·ÙŠØ¹ Ø§Ø±Ø³Ø§Ù„ Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©">Ù„Ø§ Ø§Ø³ØªØ·ÙŠØ¹ Ø§Ø±Ø³Ø§Ù„ Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©</option>
        </select>
        <label>Ø§Ø±ÙØ§Ù‚ Ù…Ù„Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input type="file" id="helpFileUpload" accept="image/*">
        <div class="upload-status" id="helpUploadStatus"></div>
        <input type="text" id="helpFileLink" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" readonly>
        <label>ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</label>
        <textarea id="helpDesc" rows="5" maxlength="100" placeholder="Ø§ÙƒØªØ¨ Ù…Ø´ÙƒÙ„ØªÙƒ ÙˆØ¶Ø¹ Ø±Ù‚Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø·Ù„Ø¨ #***********"></textarea>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <button id="helpSubmitBtn">Ø¥Ø±Ø³Ø§Ù„</button>
          <div class="back-btn" id="helpBackBtn">â¬… Ø±Ø¬ÙˆØ¹</div>
        </div>
      </div>
    </div>

    <!-- games page -->
    <div id="gamesPage" class="hidden">
      <div class="form-box">
        <h3>Ø§Ø®ØªØ± Ù„Ø¹Ø¨ØªÙƒ</h3>
        <select id="gameSelect">
          <option value="">-- Ø§Ø®ØªØ± Ù„Ø¹Ø¨Ø© --</option>
          <option value="Ø£ÙƒÙˆØ§Ø¯ ÙØ±ÙŠ ÙØ§ÙŠØ±">Ø£ÙƒÙˆØ§Ø¯ ÙØ±ÙŠ ÙØ§ÙŠØ±</option>
          <option value="ÙØ±ÙŠ ÙØ§ÙŠØ± Ø§ÙŠØ¯ÙŠ">ÙØ±ÙŠ ÙØ§ÙŠØ± Ø§ÙŠØ¯ÙŠ</option>
          <option value="Ø¨Ø¨Ø¬ÙŠ Ø§ÙŠØ¯ÙŠ">Ø¨Ø¨Ø¬ÙŠ Ø§ÙŠØ¯ÙŠ</option>
          <option value="Ø£ÙƒÙˆØ§Ø¯ Ø¨Ø¨Ø¬ÙŠ">Ø£ÙƒÙˆØ§Ø¯ Ø¨Ø¨Ø¬ÙŠ</option>
          <option value="Ø¬ÙˆØ§ÙƒØ±">Ø¬ÙˆØ§ÙƒØ±</option>
        </select>
        <input type="text" id="personalField" readonly>
        <input type="text" id="idField" placeholder="Ø¶Ø¹ Ø§Ù„Ø§ÙŠØ¯ÙŠ" oninput="this.value=this.value.replace(/[^0-9]/g,'')">
        <div id="optionsContainer"></div>
        <div id="priceDisplay"></div>
        <button id="submitForm" disabled>Ø¥Ø±Ø³Ø§Ù„</button>
        <div class="price-note" id="paymentNote">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø²Ù…Ø© Ø«Ù… Ø§Ø¶ØºØ· Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹</div>
        <div id="orderStatus" style="color:#0f0;font-weight:bold;text-align:center;margin-top:10px;"></div>
        <div style="text-align:center;">
          <button id="goOrdersBtn" class="small-btn hidden">Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
        </div>
        <div class="back-btn" id="gamesBackBtn">â¬… Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
      </div>
    </div>

    <!-- apps page -->
    <div id="appsPage" class="hidden">
      <div class="form-box">
        <h3>Ø§Ø®ØªØ± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h3>
        <select id="appSelect">
          <option value="">-- Ø§Ø®ØªØ± ØªØ·Ø¨ÙŠÙ‚ --</option>
          <option value="ØªØ·Ø¨ÙŠÙ‚ 1">ØªØ·Ø¨ÙŠÙ‚ 1</option>
          <option value="ØªØ·Ø¨ÙŠÙ‚ 2">ØªØ·Ø¨ÙŠÙ‚ 2</option>
          <option value="ØªØ·Ø¨ÙŠÙ‚ 3">ØªØ·Ø¨ÙŠÙ‚ 3</option>
        </select>
        <input type="text" id="appPersonalField" readonly>
        <input type="text" id="appIdField" placeholder="Ø¶Ø¹ Ø§Ù„Ø§ÙŠØ¯ÙŠ" oninput="this.value=this.value.replace(/[^0-9]/g,'')">
        <div id="optionsContainerApps"></div>
        <div id="priceDisplayApps"></div>
        <button id="appSubmitForm" disabled>Ø¥Ø±Ø³Ø§Ù„</button>
        <div class="price-note" id="appPaymentNote">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø©/Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø«Ù… Ø§Ø¶ØºØ· Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹</div>
        <div id="appOrderStatus" style="color:#0f0;font-weight:bold;text-align:center;margin-top:10px;"></div>
        <div style="text-align:center;">
          <button id="goOrdersBtnApp" class="small-btn hidden">Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
        </div>
        <div class="back-btn" id="appsBackBtn">â¬… Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
      </div>
    </div>

    <!-- offers page -->
    <div id="offersPage" class="hidden">
      <div class="form-box">
        <h3 style="text-align:center;color:#FFCB01;">Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ù‡Ø¯Ø§ÙŠØ§</h3>
        <div id="offersList"></div>
        <div class="back-btn" id="offersBackBtn">â¬… Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
      </div>
    </div>

    <!-- payment details page -->
    <div id="paymentDetailsPage" class="hidden">
      <div class="form-box">
        <div class="back-btn" id="pdBackBtn">â¬… Ø±Ø¬ÙˆØ¹</div>
        <h3 id="pdTitle" style="text-align:center;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹</h3>
        <div id="pdContent">
          <div id="pdTopInfo" style="text-align:center;margin-bottom:10px;color:#FFCB01;font-weight:bold;"></div>
          <select id="pdCashSelect">
            <option value="">-- Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ --</option>
            <option value="sham">Ø´Ø§Ù… ÙƒØ§Ø´</option>
            <option value="syrtel">Ø³ÙŠØ±ØªÙŠÙ„ ÙƒØ§Ø´</option>
            <option value="mtn">MTN ÙƒØ§Ø´</option>
            <option value="hawala">Ø­ÙˆØ§Ù„Ø© Ù…Ø§Ù„ÙŠØ©</option>
          </select>
          <div style="position:relative; margin-bottom:10px;">
            <input type="text" id="pdCopyField" readonly style="width:100%;padding-right:80px;">
            <button type="button" id="pdCopyBtn" style="position:absolute;left:0;top:0;height:100%;width:70px;cursor:pointer;">Ù†Ø³Ø®</button>
          </div>
          <div style="text-align:center;margin-bottom:10px;">
            <button type="button" id="pdToggleQrBtn">Ø§Ø¸Ù‡Ø±/Ø§Ø®ÙÙ QR</button>
          </div>
          <div id="qrContainer" style="display:none;margin-top:10px;text-align:center;">
            <img id="qrImg" src="https://i.postimg.cc/vHYg2nK5/IMG.jpg" alt="QR Ø´Ø§Ù…" style="width:300px;height:auto;">
          </div>
          <div id="syrtelQrContainer" style="display:none;margin-top:10px;text-align:center;">
            <img id="syrtelQrImg" src="https://i.postimg.cc/tT6ScwYv/IMG.jpg" alt="QR Ø³ÙŠØ±ØªÙŠÙ„" style="width:300px;height:auto;">
          </div>

          <div id="shamFields" style="display:none;margin-top:10px;">
            <div style="padding:8px;border:1px solid #333;border-radius:8px;">
              <strong>ØªØ­ÙˆÙŠÙ„ Ø´Ø§Ù… ÙƒØ§Ø´ Ø¥Ù„Ù‰:</strong>
              <div style="margin-top:6px;">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†/Ø§Ù„Ù…Ø­ÙØ¸Ø©: <span id="shamAddressDisplay">e5eca798a4add8f1b86d389330131c82</span></div>
            </div>
          </div>

          <div id="syrtelFields" style="display:none;margin-top:10px;">
            <div style="padding:8px;border:1px solid #333;border-radius:8px;">
              <strong>ØªØ­ÙˆÙŠÙ„ Ø³ÙŠØ±ØªÙŠÙ„ ÙƒØ§Ø´ Ø¥Ù„Ù‰:</strong>
              <div style="margin-top:6px;">Ø§Ù„Ø±Ù‚Ù…: <span id="syrtelAddressDisplay">72289118</span></div>
            </div>
          </div>

          <div id="hawalaFields" style="display:none;margin-top:10px;">
            <div style="padding:8px;border:1px solid #333;border-radius:8px;">
              <strong>Ù‚Ù… Ø¨ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØªØ§Ù„ÙŠ:</strong>
              <div style="margin-top:8px;">Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ø­Ù…Ø¯ Ø¹ØªÙˆÙ†</div>
              <div class="muted-small" style="margin-top:8px;color:#ccc;">
                Ø§Ù„ØªØ­ÙˆÙŠÙ„ ÙŠØªÙ… Ø¹Ø¨Ø± Ù…ÙƒØ§ØªØ¨ Ø§Ù„ØµØ±Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø³ÙˆØ±ÙŠØ§ Ù…Ø«Ù„: Ø§Ù„Ù‡Ø±Ù…ØŒ Ø§Ù„ÙØ¤Ø§Ø¯ØŒ Ø¯ÙˆÙÙŠØ²ØŒ Ø§Ù„Ø®...
              </div>
            </div>
          </div>

          <input type="file" id="paymentFileUpload" accept="image/*">
          <div class="upload-status" id="paymentUploadStatus"></div>
          <input type="text" id="paymentFileLink" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§" readonly>
          <div id="pdPriceInfo" style="color:#0f0;font-weight:bold;margin-top:10px;text-align:center"></div>
          <div class="price-note" id="pdNote" style="white-space:pre-line">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª</div>
          <button id="pdSubmitForm">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
        </div>
      </div>
    </div>

    <!-- orders page -->
    <div id="ordersPage" class="hidden">
      <div class="form-box">
        <h3 style="text-align:center">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
        <div id="ordersList" class="orders-list"></div>
        <div class="back-btn" id="ordersBackBtn">â¬… Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
      </div>
    </div>

    <!-- review page -->
    <div id="reviewPage" class="hidden">
      <div class="form-box" style="text-align:center;">
        <h3>ØªÙ… Ø§Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ</h3>
        <p id="reviewMsg">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ ÙˆØ³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡</p>
        <div class="back-btn" id="reviewBackBtn">â¬… Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
      </div>
    </div>

  </main>

<script>
/* ---------- Frontend logic ---------- 
   ÙŠØªÙˆØ§ØµÙ„ Ù…Ø¹ backend Ø¹Ø¨Ø± /api/*
   ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ØŒ Ø§Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ø§ØªØŒ Ù…Ø³Ø§Ø¹Ø¯Ø©ØŒ Ø´Ø­Ù† Ø±ØµÙŠØ¯ØŒ Ø¹Ø±ÙˆØ¶ØŒ Ø§Ø´Ø¹Ø§Ø±Ø§Øª.
*/

// helpers
const API_ROOT = 'https://fourb-tawy.onrender.com/';

function $(id){ return document.getElementById(id); }
function show(id){ $(id).classList.remove('hidden'); }
function hide(id){ $(id).classList.add('hidden'); }
function hideAllPages(){
  ['homePage','gamesPage','appsPage','ordersPage','paymentDetailsPage','reviewPage','helpPage','profilePage','loginPage','offersPage'].forEach(id => { const e=$(id); if(e) e.classList.add('hidden'); });
}
let currentProfile = null;
let selectedGameOption = '';
let selectedAppOption = '';
let currentMap = null;
const priceMapFF={"100 Ø¬ÙˆØ§Ù‡Ø±":"12500 Ù„.Ø³","200 Ø¬ÙˆØ§Ù‡Ø±":"25000 Ù„.Ø³","300 Ø¬ÙˆØ§Ù‡Ø±":"60000 Ù„.Ø³","530 Ø¬ÙˆØ§Ù‡Ø±":"60000 Ù„.Ø³","1080 Ø¬ÙˆØ§Ù‡Ø±":"120000 Ù„.Ø³","2200 Ø¬ÙˆØ§Ù‡Ø±":"240000 Ù„.Ø³","Ø¹Ø¶ÙˆÙŠØ© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©":"30000 Ù„.Ø³","Ø¹Ø¶ÙˆÙŠØ© Ø´Ù‡Ø±ÙŠØ©":"140000 Ù„.Ø³"};
const priceMapPUBG={"60 Ø´Ø¯Ø©":"6000 Ù„.Ø³","325 Ø´Ø¯Ø©":"25000 Ù„.Ø³","660 Ø´Ø¯Ø©":"48000 Ù„.Ø³","1800 Ø´Ø¯Ø©":"120000 Ù„.Ø³","3850 Ø´Ø¯Ø©":"240000 Ù„.Ø³","8100 Ø´Ø¯Ø©":"480000 Ù„.Ø³"};
const priceMappubg1={"ÙƒÙˆØ¯ 60 Ø´Ø¯Ù‡":"12500 Ù„.Ø³"};
const priceMapApps = {"ØªØ·Ø¨ÙŠÙ‚ 1":"5000 Ù„.Ø³","ØªØ·Ø¨ÙŠÙ‚ 2":"10000 Ù„.Ø³","ØªØ·Ø¨ÙŠÙ‚ 3":"15000 Ù„.Ø³"};

// init UI bindings
document.addEventListener('DOMContentLoaded', ()=> {
  // menu open/close
  $('menuBtn').addEventListener('click', ()=> { $('sidebar').classList.toggle('active'); });
  $('sidebarCloseBtn').addEventListener('click', ()=> { $('sidebar').classList.remove('active'); });
  $('sidebarProfileArea').addEventListener('click', ()=> { openProfile(); $('sidebar').classList.remove('active'); });

  // sidebar links
  $('linkHome').addEventListener('click', e=>{ e.preventDefault(); showHome(); $('sidebar').classList.remove('active'); });
  $('linkOrders').addEventListener('click', e=>{ e.preventDefault(); showOrders(); $('sidebar').classList.remove('active'); });
  $('linkContact').addEventListener('click', e=>{ e.preventDefault(); window.open('https://wa.me/79228576801','_blank'); $('sidebar').classList.remove('active'); });
  $('linkHelp').addEventListener('click', e=>{ e.preventDefault(); showHelp(); $('sidebar').classList.remove('active'); });
  $('linkOffers').addEventListener('click', e=>{ e.preventDefault(); showOffers(); $('sidebar').classList.remove('active'); });
  $('linkJoinWhats').addEventListener('click', e=>{ e.preventDefault(); window.open('https://chat.whatsapp.com/LvrWRUCqLOw4cxjPlnH33J?mode=ems_copy_t','_blank'); });
  $('linkGames').addEventListener('click', e=>{ e.preventDefault(); showGames(); $('sidebar').classList.remove('active'); });
  $('linkApps').addEventListener('click', e=>{ e.preventDefault(); showApps(); $('sidebar').classList.remove('active'); });
  $('btnCharge').addEventListener('click', ()=>{ $('sidebar').classList.remove('active'); openChargePage(); });

  // notif
  $('notifBell').addEventListener('click', ()=> { $('notifPanel').classList.toggle('hidden'); loadNotifications(); });
  $('notifCloseBtn').addEventListener('click', ()=> $('notifPanel').classList.add('hidden'));
  $('notifClearBtn').addEventListener('click', () => { $('notifList').innerHTML=''; $('notifBadge').classList.add('hidden'); });

  // login toggles
  $('loginTogglePwd').addEventListener('click', function(){ const inp=$('loginPassword'); if(inp.type==='password'){ inp.type='text'; this.textContent='Ø§Ø®ÙÙ'; } else { inp.type='password'; this.textContent='Ø§Ø¸Ù‡Ø§Ø±'; }});
  $('doLoginBtn').addEventListener('click', doLogin);

  // profile
  $('requestEditBtn').addEventListener('click', requestProfileEdit);
  $('confirmSaveBtn').addEventListener('click', confirmProfileSave);
  $('profileBackBtn').addEventListener('click', showHome);

  // help
  $('helpBackBtn').addEventListener('click', showHome);
  $('helpSubmitBtn').addEventListener('click', submitHelp);
  $('helpFileUpload').addEventListener('change', async function(){ await uploadFileToImgbb(this.files[0], 'helpFileLink','helpUploadStatus'); });

  // games/app selects
  $('gameSelect').addEventListener('change', function(){ buildGameOptions(this.value); });
  $('appSelect').addEventListener('change', function(){ buildAppOptions(this.value); });

  $('idField').addEventListener('input', updateSubmitButtonGames);
  $('appIdField').addEventListener('input', updateSubmitButtonApps);
  $('submitForm').addEventListener('click', ()=> showPaymentDetailsFromSubmit('gamesPage'));
  $('appSubmitForm').addEventListener('click', ()=> showPaymentDetailsFromSubmit('appsPage'));

  // payment details
  $('pdCashSelect').addEventListener('change', onPdCashChange);
  $('pdToggleQrBtn').addEventListener('click', toggleQr);
  $('pdCopyBtn').addEventListener('click', ()=>{ const val=$('pdCopyField').value; if(val) navigator.clipboard?.writeText(val).then(()=>alert('ØªÙ… Ø§Ù„Ù†Ø³Ø®')).catch(()=>prompt('Ø§Ù†Ø³Ø® ÙŠØ¯ÙˆÙŠØ§Ù‹:',val)); else alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Øµ Ù„Ù„Ù†Ø³Ø®'); });
  $('paymentFileUpload').addEventListener('change', async function(){ await uploadFileToImgbb(this.files[0], 'paymentFileLink','paymentUploadStatus'); });
  $('pdSubmitForm').addEventListener('click', submitPaymentDetails);
  $('pdBackBtn').addEventListener('click', ()=> returnFromPaymentDetails());

  // orders page
  $('ordersBackBtn').addEventListener('click', showHome);

  // review page
  $('reviewBackBtn').addEventListener('click', showHome);

  // offers page
  $('offersBackBtn').addEventListener('click', showHome);

  // buttons
  $('cardGames').addEventListener('click', showGames);
  $('cardApps').addEventListener('click', showApps);
  $('goOrdersBtn').addEventListener('click', showOrders);
  $('goOrdersBtnApp').addEventListener('click', showOrders);

  // load profile from localStorage if present
  const saved = localStorage.getItem('user_profile_v1');
  if(saved){
    try{ currentProfile = JSON.parse(saved); }catch(e){ currentProfile = null; }
  }
  if(!currentProfile){
    // create temporary personalNumber if none
    let pn = localStorage.getItem('personalNumber');
    if(!pn){ pn = String(Math.floor(1000000 + Math.random()*9000000)); localStorage.setItem('personalNumber', pn); }
    currentProfile = { personalNumber: pn, name:'Ø¶ÙŠÙ', email:'', phone:'', balance:0, canEdit:false };
    localStorage.setItem('user_profile_v1', JSON.stringify(currentProfile));
  }
  refreshUIFromProfile();
  showHome();
  // poll server for updates every 6s
  setInterval(()=>{ refreshNotificationsCount(); fetchOffers(); }, 6000);
  refreshNotificationsCount();
  fetchOffers();
});

// ---------- UI/page navigation ----------
function showHome(){ hideAllPages(); show('homePage'); window.scrollTo({top:0}); }
function showGames(){ hideAllPages(); show('gamesPage'); window.scrollTo({top:0}); }
function showApps(){ hideAllPages(); show('appsPage'); window.scrollTo({top:0}); }
function showHelp(){ hideAllPages(); show('helpPage'); window.scrollTo({top:0}); }
function openProfile(){ hideAllPages(); show('profilePage'); fillProfileFields(); }
function openChargePage(){ /* reuse paymentDetailsPage for charging but simpler UI could be added */ hideAllPages(); show('paymentDetailsPage'); $('pdTitle').textContent='Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯'; $('pdTopInfo').textContent='Ø§Ø·Ù„Ø¨ Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ø¹Ø¨Ø± Ø±ÙØ¹ Ø§ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„'; }
function showOrders(){ hideAllPages(); show('ordersPage'); loadOrdersList(); }
function showOffers(){ hideAllPages(); show('offersPage'); fetchOffers(); }

// ---------- profile helpers ----------
function refreshUIFromProfile(){
  $('personalNum').textContent = currentProfile.personalNumber || '';
  $('personalField').value = currentProfile.personalNumber || '';
  $('appPersonalField').value = currentProfile.personalNumber || '';
  $('helpPersonalField').value = currentProfile.personalNumber || '';
  $('loginPersonalNumber').value = currentProfile.personalNumber || '';
  $('sidebarName').textContent = currentProfile.name || 'Ø¶ÙŠÙ';
  $('sidebarAvatar').textContent = (currentProfile.name && currentProfile.name.trim().length>0) ? currentProfile.name.trim().charAt(0).toUpperCase() : 'Ø£';
  $('sidebarPersonal').textContent = 'Ø±Ù‚Ù…: ' + (currentProfile.personalNumber || '');
}
function fillProfileFields(){
  $('profileName').value = currentProfile.name || '';
  $('profileEmail').value = currentProfile.email || '';
  $('profilePassword').value = currentProfile.password || '';
  $('profilePhone').value = currentProfile.phone || '';
  applyProfileEditState();
}
function applyProfileEditState(){
  const canEdit = !!currentProfile.canEdit;
  ['profileName','profileEmail','profilePassword','profilePhone'].forEach(id=>{
    const el = $(id);
    if(!el) return;
    if(canEdit){ el.removeAttribute('readonly'); } else { el.setAttribute('readonly','readonly'); }
  });
  if(canEdit){ $('requestEditBtn').classList.add('hidden'); $('confirmSaveBtn').classList.remove('hidden'); $('profileMsg').textContent='ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø¢Ù† Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø«Ù… Ø§Ø¶ØºØ· Ø­ÙØ¸.'; }
  else { $('requestEditBtn').classList.remove('hidden'); $('confirmSaveBtn').classList.add('hidden'); $('profileMsg').textContent='Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ø·Ù„Ø¨ Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¹Ø¨Ø± Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡.'; }
}

// ---------- login/register ----------
async function doLogin(){
  const name = $('loginName').value.trim();
  const email = $('loginEmail').value.trim();
  const password = $('loginPassword').value;
  const phone = $('loginPhone').value.trim();
  const personal = $('loginPersonalNumber').value || currentProfile.personalNumber;
  const errEl = $('loginError');
  errEl.style.display='none';
  if(!name){ errEl.textContent='Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…'; errEl.style.display='block'; return; }
  if(email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){ errEl.textContent='ØµÙŠØºØ© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­Ø©'; errEl.style.display='block'; return; }
  if(!password){ errEl.textContent='Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±'; errEl.style.display='block'; return; }

  // call register API
  const resp = await fetch('https://fourb-tawy.onrender.com/api/register', {
    method:'POST', headers:{'content-type':'application/json'},
    body: JSON.stringify({ name, email, password, phone, personalNumber: personal })
  });
  const data = await resp.json();
  if(data && data.ok){
    currentProfile = data.profile;
    localStorage.setItem('user_profile_v1', JSON.stringify(currentProfile));
    refreshUIFromProfile();
    showHome();
    alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
  } else {
    alert('ÙØ´Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ' + (data.error || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'));
  }
}

// request profile edit (sends message to admin bot)
async function requestProfileEdit(){
  const ok = confirm('Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ');
  if(!ok) return;
  const resp = await fetch('https://fourb-tawy.onrender.com/api/profile/request-edit', {
    method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({ personal: currentProfile.personalNumber })
  });
  const data = await resp.json();
  if(data && data.ok){ alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„. Ø§Ù†ØªØ¸Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.'); $('requestEditBtn').textContent='ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨'; setTimeout(()=>$('requestEditBtn').textContent='Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ', 10000); } else { alert('ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„'); }
}

function confirmProfileSave(){
  // save to backend
  const name = $('profileName').value.trim();
  const email = $('profileEmail').value.trim();
  const password = $('profilePassword').value;
  const phone = $('profilePhone').value.trim();
  if(email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){ alert('Ø§Ù„Ø¨Ø±ÙŠØ¯ ØºÙŠØ± ØµØ§Ù„Ø­'); return; }
  currentProfile.name = name; currentProfile.email = email; currentProfile.password = password; currentProfile.phone = phone; currentProfile.canEdit = false;
  localStorage.setItem('user_profile_v1', JSON.stringify(currentProfile));
  // also call register endpoint to save server-side
  fetch('https://fourb-tawy.onrender.com/api/register', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({ name, email, password, phone, personalNumber: currentProfile.personalNumber }) });
  alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª');
  applyProfileEditState();
  refreshUIFromProfile();
}

// ---------- help submit ----------
async function submitHelp(){
  const issue = $('helpIssueSelect').value;
  const fileLink = $('helpFileLink').value;
  const desc = $('helpDesc').value.trim();
  const personal = currentProfile.personalNumber;
  if(!issue){ alert('Ø§Ø®ØªØ± Ù…Ø´ÙƒÙ„ØªÙƒ'); return; }
  const resp = await fetch('https://fourb-tawy.onrender.com/api/help', {
    method:'POST', headers:{'content-type':'application/json'},
    body: JSON.stringify({ personal, issue, fileLink, desc, name: currentProfile.name, email: currentProfile.email, phone: currentProfile.phone })
  });
  const data = await resp.json();
  if(data && data.ok){ alert('ØªÙ… Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©'); show('helpSuccessPage'); hide('helpPage'); } else { alert('ÙØ´Ù„ Ø§Ù„Ø§Ø±Ø³Ø§Ù„'); }
}

// ---------- uploading to imgbb (client-side) ----------
async function uploadFileToImgbb(file, targetInputId = 'paymentFileLink', statusElId='paymentUploadStatus'){
  if(!file) return;
  const statusEl = $(statusElId);
  if(statusEl) statusEl.textContent = 'Ø¬Ø§Ø±ÙŠØ© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø±ÙØ¹... 0%';
  try{
    const key = (await fetch('https://fourb-tawy.onrender.com/api/debug/db').then(r=>r.json()).then(d=>d && d.tgOffsets!==undefined ? null : null)) || null;
    // we'll use client-side direct imgbb with the server-provided key if needed.
    // For simplicity: call imgbb directly. (IMGBB_KEY is set server-side, but we don't expose it via API here for security.)
    // Instead we use the upload endpoints already implemented in the original file which used IMGBB_API_KEY directly on client.
    // Here we fallback to using a tiny anonymous upload service by sending file as base64 to server endpoint '/api/upload' which stores file locally.
    // But simpler for now: attempt to upload via imgbb by building a FormData and sending to the imgbb API.
    const imgbbKey = null; // we don't include key client side for security; the server has it.
    // So we will upload to server endpoint /api/upload (which returns local path), but server /uploads is static only if configured.
    // For compatibility with original flow, try using fetch to https://api.imgbb.com/1/upload with the key inlined (not ideal but user gave key earlier).
    // We'll prompt the user to confirm using the shared key (since you asked to use the key).
    const confirmUseKey = true;
    if(confirmUseKey){
      // use the provided key (this is okay here because you gave it)
      const IMGBB_KEY = "e5603dfd5675ed2b5a671577abcf6d33";
      const fd = new FormData();
      fd.append('image', file);
      const xhr = new XMLHttpRequest();
      xhr.open('POST', `https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`);
      xhr.onload = function(){
        if(xhr.status>=200 && xhr.status<300){
          try{
            const resp = JSON.parse(xhr.responseText||'{}');
            const url = resp && resp.data && (resp.data.url || resp.data.display_url);
            if(url){
              $(targetInputId).value = url;
              if(statusEl) statusEl.textContent = 'ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­';
              alert('ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù');
            } else {
              if(statusEl) statusEl.textContent = 'ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹';
              alert('ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù');
            }
          }catch(e){ if(statusEl) statusEl.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¹'; alert('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù'); }
        } else {
          if(statusEl) statusEl.textContent = 'ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹';
          alert('ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹: ' + xhr.status);
        }
      };
      xhr.onerror = function(){ if(statusEl) statusEl.textContent='Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©'; alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹'); };
      xhr.upload.onprogress = function(ev){ if(ev.lengthComputable){ const pct = Math.round((ev.loaded/ev.total)*100); if(statusEl) statusEl.textContent = `Ø¬Ø§Ø±ÙŠØ© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø±ÙØ¹... ${pct}%`; } };
      xhr.send(fd);
    }
  }catch(e){ console.error(e); if($(statusElId)) $(statusElId).textContent = 'Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹'; alert('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹'); }
}

// ---------- games/apps options ----------
function buildGameOptions(val){
  $('optionsContainer').innerHTML=''; selectedGameOption=''; $('priceDisplay').textContent='';
  if(val==='ÙØ±ÙŠ ÙØ§ÙŠØ± Ø§ÙŠØ¯ÙŠ'){ currentMap = priceMapFF; }
  else if(val==='Ø¨Ø¨Ø¬ÙŠ Ø§ÙŠØ¯ÙŠ'){ currentMap = priceMapPUBG; }
  else if(val==='Ø¬ÙˆØ§ÙƒØ±'){ currentMap = priceMappubg1; }
  else currentMap = null;
  if(currentMap){
    Object.keys(currentMap).forEach(opt=>{
      const d = document.createElement('div'); d.className='button-option'; d.textContent = opt;
      d.addEventListener('click', ()=> {
        document.querySelectorAll('#optionsContainer .button-option').forEach(x=>x.classList.remove('selected'));
        d.classList.add('selected');
        selectedGameOption = opt;
        $('priceDisplay').textContent = `Ø§Ù„Ø­Ø²Ù…Ø©: ${opt}\nØ§Ù„Ø³Ø¹Ø±: ${currentMap[opt]}`; $('priceDisplay').style.color='#0f0';
        updateSubmitButtonGames();
      });
      $('optionsContainer').appendChild(d);
    });
  }
}

function buildAppOptions(val){
  $('optionsContainerApps').innerHTML=''; selectedAppOption=''; $('priceDisplayApps').textContent='';
  if(priceMapApps[val]){
    const d = document.createElement('div'); d.className='button-option'; d.textContent = val;
    d.addEventListener('click', ()=> {
      document.querySelectorAll('#optionsContainerApps .button-option').forEach(x=>x.classList.remove('selected'));
      d.classList.add('selected');
      selectedAppOption = val;
      $('priceDisplayApps').textContent = `Ø§Ù„Ø³Ø¹Ø±: ${priceMapApps[val]}`; $('priceDisplayApps').style.color='#0f0';
      updateSubmitButtonApps();
    });
    $('optionsContainerApps').appendChild(d);
  }
}

function updateSubmitButtonGames(){ const idf=$('idField').value.trim(); $('submitForm').disabled = !(selectedGameOption && idf); }
function updateSubmitButtonApps(){ const idf=$('appIdField').value.trim(); $('appSubmitForm').disabled = !(selectedAppOption && idf); }

// ---------- payment flow ----------
let previousBeforePayment = null;
function showPaymentDetailsFromSubmit(fromPage){
  previousBeforePayment = fromPage;
  hideAllPages(); show('paymentDetailsPage');
  $('pdTopInfo').textContent = '';
  $('pdPriceInfo').textContent = '';
  $('pdCashSelect').value = '';
  $('pdCopyField').value = '';
  $('qrContainer').style.display='none';
  $('syrtelQrContainer').style.display='none';
  $('paymentFileLink').value = '';
  $('paymentUploadStatus').textContent = '';
  $('pdNote').textContent = 'Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª';
  $('shamFields').style.display='none'; $('syrtelFields').style.display='none'; $('hawalaFields').style.display='none';
}

function returnFromPaymentDetails(){ if(previousBeforePayment==='gamesPage') showGames(); else if(previousBeforePayment==='appsPage') showApps(); else showHome(); }

// pd cash change
function onPdCashChange(){
  const value = $('pdCashSelect').value;
  const pdNoteEl = $('pdNote');
  if(value==='sham'){
    $('shamFields').style.display='block'; $('syrtelFields').style.display='none'; $('hawalaFields').style.display='none';
    $('qrContainer').style.display='none'; $('syrtelQrContainer').style.display='none';
    $('pdCopyField').value = 'e5eca798a4add8f1b86d389330131c82';
    pdNoteEl.textContent = `ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø´Ø§Ù… ÙƒØ§Ø´...`;
  } else if(value==='syrtel'){
    $('shamFields').style.display='none'; $('syrtelFields').style.display='block'; $('hawalaFields').style.display='none';
    $('pdCopyField').value = '72289118';
    pdNoteEl.textContent = `ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø³ÙŠØ±ØªÙŠÙ„...`;
  } else if(value==='hawala'){
    $('shamFields').style.display='none'; $('syrtelFields').style.display='none'; $('hawalaFields').style.display='block';
    $('pdCopyField').value = '';
    pdNoteEl.textContent = `Ù‚Ù… Ø¨ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¥Ù„Ù‰: Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ø­Ù…Ø¯ Ø¹ØªÙˆÙ†`;
  } else {
    $('shamFields').style.display='none'; $('syrtelFields').style.display='none'; $('hawalaFields').style.display='none';
    $('pdCopyField').value = '';
    pdNoteEl.textContent = 'Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª';
  }
}

function toggleQr(){
  const m = $('pdCashSelect').value;
  if(m==='sham'){ $('qrContainer').style.display = $('qrContainer').style.display === 'none' ? 'block' : 'none'; }
  else if(m==='syrtel'){ $('syrtelQrContainer').style.display = $('syrtelQrContainer').style.display === 'none' ? 'block' : 'none'; }
  else alert('ØµÙˆØ±Ø© QR ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©');
}

// submit payment details -> creates order or charge
async function submitPaymentDetails(){
  const cashMethod = $('pdCashSelect').value;
  const fileLink = $('paymentFileLink').value;
  if(!cashMethod){ alert('Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹'); return; }
  // if coming from games
  if(previousBeforePayment === 'gamesPage'){
    const personal = $('personalField').value;
    const game = $('gameSelect').value;
    const idField = $('idField').value;
    const price = $('priceDisplay').textContent || '';
    if(!game || !idField || !selectedGameOption){ alert('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'); return; }
    const body = { personal, phone: currentProfile.phone, type:'Ø´Ø­Ù† Ù„Ø¹Ø¨Ø©', item: `${game} - ${selectedGameOption}`, idField, fileLink, cashMethod };
    const r = await fetch('https://fourb-tawy.onrender.com/api/orders', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify(body) });
    const data = await r.json();
    if(data && data.ok){ hideAllPages(); show('reviewPage'); $('reviewMsg').textContent='ØªÙ… Ø§Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ ÙˆØ³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡'; localStorage.setItem('lastOrderId', data.order.id); } else alert('ÙØ´Ù„ Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨');
  } else if(previousBeforePayment === 'appsPage'){
    const personal = $('appPersonalField').value;
    const app = $('appSelect').value;
    const idField = $('appIdField').value;
    if(!app || !idField || !selectedAppOption){ alert('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'); return; }
    const body = { personal, phone: currentProfile.phone, type:'Ø´Ø±Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚', item: `${app} - ${selectedAppOption}`, idField, fileLink, cashMethod };
    const r = await fetch('https://fourb-tawy.onrender.com/api/orders', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify(body) });
    const data = await r.json();
    if(data && data.ok){ hideAllPages(); show('reviewPage'); $('reviewMsg').textContent='ØªÙ… Ø§Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚'; } else alert('ÙØ´Ù„ Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨');
  } else {
    // if this is charge flow
    const personal = currentProfile.personalNumber;
    const amount = prompt('ÙƒÙ… Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø´Ø­Ù†Ù‡ØŸ (Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ÙÙ‚Ø·)');
    if(!amount || isNaN(Number(amount))){ alert('Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©'); return; }
    const method = cashMethod || 'unknown';
    const r = await fetch('https://fourb-tawy.onrender.com/api/charge', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({ personal, phone: currentProfile.phone, amount, method, fileLink }) });
    const data = await r.json();
    if(data && data.ok){ alert('ØªÙ… Ø§Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø­Ù†. Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©.'); hideAllPages(); showHome(); } else alert('ÙØ´Ù„ Ø§Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø­Ù†');
  }
}

// ---------- load orders / list ----------
async function loadOrdersList(){
  const personal = currentProfile.personalNumber;
  const resp = await fetch('https://fourb-tawy.onrender.com/api/notifications/' + personal);
  const data = await resp.json();
  if(data && data.ok){
    const orders = data.orders || [];
    const charges = data.charges || [];
    const container = $('ordersList'); container.innerHTML = '';
    if(orders.length===0 && charges.length===0){ container.innerHTML = '<div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>'; return; }
    orders.forEach(o=>{
      const d = document.createElement('div'); d.className='order-item';
      d.innerHTML = `<strong>#${o.id}</strong> - ${o.type} - ${o.item || ''} <br> Ø§Ù„Ø§ÙŠØ¯ÙŠ: ${o.idField || ''} <br> Ø§Ù„Ù‡Ø§ØªÙ: ${o.phone || ''} <br> Ø§Ù„Ø­Ø§Ù„Ø©: <strong>${o.status}</strong> <br> Ø£Ù†Ø´Ø¦: ${new Date(o.createdAt).toLocaleString()}`;
      container.appendChild(d);
    });
    charges.forEach(c=>{
      const d = document.createElement('div'); d.className='order-item';
      d.innerHTML = `<strong>#${c.id}</strong> - Ø´Ø­Ù† Ø±ØµÙŠØ¯ - Ø§Ù„Ù…Ø¨Ù„Øº: ${c.amount} <br> Ø§Ù„Ø­Ø§Ù„Ø©: <strong>${c.status}</strong> <br> Ø£Ù†Ø´Ø¦: ${new Date(c.createdAt).toLocaleString()}`;
      container.appendChild(d);
    });
  }
}

// ---------- notifications & offers ----------
async function refreshNotificationsCount(){
  const resp = await fetch('https://fourb-tawy.onrender.com/api/notifications/' + currentProfile.personalNumber);
  const data = await resp.json();
  if(data && data.ok){
    const offers = data.offers || [];
    const orders = data.orders || [];
    const charges = data.charges || [];
    const unreadCount = (orders.filter(o=>o.replied).length) + (charges.filter(c=>c.replied).length) + (offers.length>0 ? 1 : 0);
    if(unreadCount>0){ $('notifBadge').classList.remove('hidden'); $('notifBadge').textContent = String(unreadCount); } else { $('notifBadge').classList.add('hidden'); }
  }
}

async function loadNotifications(){
  const resp = await fetch('https://fourb-tawy.onrender.com/api/notifications/' + currentProfile.personalNumber);
  const data = await resp.json();
  if(data && data.ok){
    const offers = data.offers || [];
    const orders = data.orders || [];
    const charges = data.charges || [];
    const list = $('notifList'); list.innerHTML = '';
    orders.filter(o=>o.replied).forEach(o=>{
      const el = document.createElement('div'); el.style.padding='8px'; el.style.border='1px solid rgba(255,203,1,0.06)'; el.style.marginBottom='8px';
      el.innerHTML = `<div><strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ #${o.id}</strong></div><div>${o.status}</div>`;
      list.appendChild(el);
    });
    charges.filter(c=>c.replied).forEach(c=>{
      const el = document.createElement('div'); el.style.padding='8px'; el.style.border='1px solid rgba(255,203,1,0.06)'; el.style.marginBottom='8px';
      el.innerHTML = `<div><strong>Ø­Ø§Ù„Ø© Ø´Ø­Ù†Ø© #${c.id}</strong></div><div>${c.status}</div>`;
      list.appendChild(el);
    });
    offers.forEach(of=>{
      const el = document.createElement('div'); el.style.padding='8px'; el.style.border='1px solid rgba(255,203,1,0.06)'; el.style.marginBottom='8px';
      el.innerHTML = `<div><strong>Ø¹Ø±Ø¶</strong></div><div>${of.text}</div><div style="margin-top:6px;"><button class="small-btn" onclick="ackOffer('${of.id}')">ØªØ­Ù‚Ù‚</button></div>`;
      list.appendChild(el);
    });
  }
}

async function fetchOffers(){
  const resp = await fetch('https://fourb-tawy.onrender.com/api/notifications/' + currentProfile.personalNumber);
  const data = await resp.json();
  if(data && data.ok){
    const offers = data.offers || [];
    const container = $('offersList'); container.innerHTML = '';
    offers.forEach(of=>{
      const el = document.createElement('div'); el.style.border='1px solid rgba(255,203,1,0.06)'; el.style.padding='8px'; el.style.marginBottom='8px';
      el.innerHTML = `<div>${of.text}</div><div style="margin-top:8px;"><button class="small-btn" onclick="ackOffer('${of.id}')">ØªØ­Ù‚Ù‚</button></div>`;
      container.appendChild(el);
    });
  }
}

async function ackOffer(id){
  const resp = await fetch('https://fourb-tawy.onrender.com/api/offer/ack', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({ personal: currentProfile.personalNumber, offerId: id }) });
  const data = await resp.json();
  if(data && data.ok){ alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ù‚Ù‚'); }
}

// ---------- util: upload local file -> imgbb handled above ----------

// ---------- misc ----------
// fetch DB debug for imgbb key etc (not required)
async function fetchDBDebug(){ const d = await fetch('https://fourb-tawy.onrender.com/api/debug/db').then(r=>r.json()); return d; }

</script>
</body>
        </html>
